# 更新日志

## 2025-11-27

### 订单详情页优化调整

#### APP优化内容
1. 产品信息“牙位”采用田字格展示，样式与下单页一致。
2. “基础信息”改为“收件信息”，显示收件人、电话、收件地址。
3. 颜色设定新增“牙位”字段，并调整标签为：主色、颈部颜色、中部颜色、切端颜色、基牙颜色、牙体颜色、自定义色。
4. 在“上传的文件”下新增“3D文件”区块，展示方式与“上传的文件”一致。

#### 文件变更
- 修改文件
  - `src/pages/OrderManagement/OrderDetail.jsx` — 订单详情页结构与展示调整
  - `../DentaSyncApp/src/pages/OrderDetail.jsx` — 移动端订单详情页同步调整
  - `../DentaSyncApp/src/pages/OrderDetail.css` — 增加牙位田字格样式

## 2025-11-20

### 登录页功能优化

#### 新增功能
1. **临时角色选择**
   - 在登录页面新增“临时角色”下拉选项（选填）
   - 选项包含：诊所-管理员、诊所-医生、诊所-助理、工厂-管理员、工厂-助理、工厂-技师、超级管理员
   - 登录成功后写入用户信息并持久化到 `localStorage`

#### 文件变更
- **修改文件**
  - `src/pages/Login/Login.jsx` - 新增临时角色选择下拉并接入登录逻辑
  - `CHANGELOG.md` - 更新日志

### 角色驱动的菜单与人员管理

#### 规则与实现
1. **工厂人员隐藏“下单”**
   - 登录角色为工厂（管理员/助理/技师）时，左侧不显示`下单`及其子菜单
2. **工厂管理员限制角色选项**
   - 人员管理中，角色选择仅显示`助理`、`技师`
3. **工厂管理员人员表单字段**
   - 新建/编辑人员弹窗中，将“所属诊所:”动态显示为“所属工厂:”
   - 角色选择仅显示`助理`、`技师`
4. **非管理员隐藏人员管理**
   - 不是工厂管理员或诊所管理员（超级管理员除外），左侧不显示`人员管理`
5. **系统管理仅超级管理员可见**
   - 左侧`系统管理`仅在`超级管理员`登录时显示

#### 文件变更
- **修改文件**
  - `src/layout/MainLayout.jsx` - 传递`currentUser`到`Sidebar`与`PersonnelAuth`
  - `src/layout/Sidebar.jsx` - 基于`tempRole`动态过滤菜单项
  - `src/pages/InfoSetting/PersonnelAuth.jsx` - 动态角色选项与“所属工厂/所属诊所”标签切换
  - `src/pages/InfoSetting/FactoryInfo.jsx` - 新增工厂信息页面（字段与诊所信息保持一致，适配工厂）
  - `src/layout/MainLayout.jsx` - 新增`/personal/factory-info`路由
  - `src/layout/NaviBar.jsx` - 为`/personal/factory-info`增加导航标签“工厂信息”
  - `src/pages/OrderManagement/PendingOrders.jsx` - 订单编号支持跳转订单详情
  - `src/components/MessagesModal/MessagesModal.jsx` - 标题改为“企业通信”，支持外部设置默认助理Tab
  - `src/layout/MainLayout.jsx`、`src/layout/Header.jsx` - 点击客服图标直接打开企业通信并激活“助理”Tab
  - `src/layout/Sidebar.jsx` - 超级管理员登录后隐藏“信息设置”整组菜单
  - `src/layout/Sidebar.jsx` - 超级管理员登录后同时隐藏“首页”“下单”“信息设置”

#### 提交摘要（2025-11-20）
- 登录页新增“临时角色”并写入用户信息
- 侧边栏按角色控制展示：隐藏下单/患者档案/诊所信息/信息设置（按规则）
- 新增“工厂信息”页面与路由，导航标签同步
- 待处理订单支持订单编号跳转详情
- 客服图标直达“企业通信”，默认激活“助理”Tab；消息对话框标题修正

## 2025-11-19

### 订单详情-其他设置内容完善

#### 优化内容
1. **完善其他设置展示**
   - 添加示例图片数据（口内照片、X光片等）
   - 添加示例文件数据（扫描文件、设计方案、患者病历等）
   - 添加3D文件链接示例

2. **图片展示优化**
   - 图片缩略图显示文件名（底部半透明遮罩）
   - 点击图片可放大查看（Modal弹窗）
   - 100x100的统一缩略图尺寸
   - 圆角边框和边距优化

3. **文件列表优化**
   - 卡片式文件展示
   - 显示文件图标、文件名
   - 支持显示文件大小（如有）
   - 灰色背景和边框，更清晰的视觉效果

4. **模拟数据示例**
```javascript
uploadedImages: [
  { name: '口内照片1.jpg', url: 'placeholder_url' },
  { name: '口内照片2.jpg', url: 'placeholder_url' },
  { name: 'X光片.jpg', url: 'placeholder_url' }
],
uploadedFiles: [
  { name: '扫描文件.stl' },
  { name: '设计方案.pdf' },
  { name: '患者病历.doc' }
],
threeDFile: 'https://example.com/3d-model.stl'
```

#### 文件变更
- **修改文件**
  - `src/pages/OrderManagement/OrderDetail.jsx` - 优化图片和文件显示效果，添加示例数据
  - `CHANGELOG.md` - 更新日志

### 订单详情页面优化调整

#### 界面优化
1. **删除操作历史Tab**
   - 移除了"操作历史"Tab页签
   - 简化页面结构，保留核心功能

2. **Tab标签调整**
   - "生产进度"改名为"订单状态"
   - 更准确地反映页面功能定位

3. **医技沟通按钮位置优化**
   - 从卡片右上角移至Tab栏右侧（tabBarExtraContent）
   - 在任何Tab页都可以快速访问
   - 位置更醒目，操作更便捷

#### 当前页面结构
**Tab页签：**
- **订单详情**：完整的订单信息展示
  - 基础信息
  - 患者信息
  - 产品信息
  - 颜色设定
  - 备注信息
  - 其他设置（试戴情况、设计方案、附件、图片、文件等）
  
- **订单状态**：订单状态管理和关键节点记录
  - 订单状态管理（状态选择、进度调整）
  - 关键节点时间轴（支持添加节点、上传图片和文件）

#### 样式优化
- 新增Tab右侧extra区域样式
- 优化医技沟通按钮显示效果

#### 文件变更
- **修改文件**
  - `src/pages/OrderManagement/OrderDetail.jsx` - 删除操作历史Tab，调整医技沟通按钮位置
  - `src/pages/OrderManagement/OrderDetail.css` - 新增Tab extra区域样式
  - `CHANGELOG.md` - 更新日志

### 订单详情页面功能优化

#### 界面调整
1. **医技沟通按钮位置调整**
   - 从基础信息卡片移动到操作历史Tab的右上角
   - 优化了操作流程，更符合用户习惯

2. **订单详情完善**
   - 在颜色设定下方新增"其他设置"部分
   - 显示试戴情况、设计方案、附件等信息
   - 支持查看上传的图片和文件
   - 支持查看3D文件链接

#### 生产进度功能实现
1. **订单状态管理**
   - 可动态修改订单状态（待接单、已接单、制作中、生产进度、已发货、已收货、已完成）
   - 可调整订单进度百分比（0-100%）
   - 实时更新状态标签显示

2. **关键节点记录**
   - 使用时间轴展示订单的所有关键节点
   - 每个节点包含：时间、操作人、操作动作、详细描述
   - 支持添加新的进度节点
   - 节点类型包括：已接单、安排生产、开始生产、生产完成、质检完成、打包发货、已签收等

3. **节点文件管理**
   - 每个节点支持上传多张图片
   - 每个节点支持上传多个文件
   - 图片支持点击放大查看
   - 文件列表清晰展示

4. **添加节点对话框**
   - 表单化操作，信息填写完整
   - 支持选择预设操作类型或自定义
   - 图片和文件上传即时预览
   - 可删除已上传的图片和文件

#### 样式优化
1. **卡片标题样式**
   - 添加extra按钮的悬停效果
   - 统一卡片风格

2. **时间轴样式**
   - 节点标题、时间、操作人清晰展示
   - 图片缩略图支持点击查看大图
   - 文件列表紧凑排列

#### 文件变更
- **修改文件**
  - `src/pages/OrderManagement/OrderDetail.jsx` - 新增生产进度管理功能
  - `src/pages/OrderManagement/OrderDetail.css` - 新增时间轴和节点样式

#### 数据结构
订单数据新增字段：
```javascript
{
  // 其他设置
  trialStatus: '试戴蜡型外形',
  designSchemes: ['前牙美学设计', '咬合重建'],
  attachments: [
    { name: '旧模', count: 2 },
    { name: '咬胶', count: 1 }
  ],
  uploadedImages: [],
  uploadedFiles: [],
  threeDFile: null,
  
  // 生产进度节点
  progressNodes: [
    {
      id: 1,
      time: '2025-11-10 10:35:00',
      operator: '张三',
      action: '已接单',
      description: '订单已被接单，准备安排生产',
      images: [],
      files: []
    }
  ]
}
```

### 订单详情页面功能新增

#### 新增功能
1. **订单详情页面**
   - 创建独立的订单详情页面组件
   - 支持从全部订单页面点击订单编号跳转
   - 在NaviBar中自动显示订单详情标签页

#### 页面结构
1. **页面标题栏**
   - 返回按钮：点击返回上一页
   - 订单编号显示：显示当前查看的订单编号
   - 医技沟通按钮：快速进入消息对话

2. **Tab页签**
   - **订单详情**：完整的订单信息展示（只读）
   - **生产进度**：待开发
   - **操作历史**：待开发

#### 订单详情Tab内容
1. **订单状态卡片**
   - 订单状态标签（待接单、已接单、生产进度-33%、生产进度-66%、生产进度-100%、已发货、已收货等）
   - 订单进度百分比显示

2. **基础信息卡片**
   - 订单编号
   - 订单类型（标准订单/加急订单）
   - 订单类别（全瓷牙冠/固定牙桥等）
   - 诊所
   - 医生
   - 生产单位
   - 收件人
   - 收件地址
   - 下单时间
   - 预计到货时间

3. **患者信息卡片**
   - 患者姓名
   - 患者手机号
   - 性别
   - 年龄

4. **产品信息卡片**
   - 产品名称
   - 牙位
   - 修复方式
   - 取模方式
   - 扫描设备
   - 连接方式

5. **颜色设定卡片**（如有）
   - 主体颜色
   - 颈部颜色
   - 中部颜色
   - 切端颜色

6. **备注信息卡片**（如有）
   - 订单备注内容

#### 功能特性
1. **数据传递**
   - 从全部订单页面点击订单编号时，通过路由state传递订单数据
   - 如果没有传递数据，使用默认模拟数据

2. **状态映射**
   - 支持多种订单状态的颜色标签显示
   - 待接单：灰色
   - 已接单/制作中：蓝色（processing）
   - 生产完成：绿色（success）
   - 已发货：橙色（warning）
   - 已收货/完成：绿色（success）

3. **医技沟通集成**
   - 点击"医技沟通"按钮打开MessagesModal
   - 可直接与工厂技师进行沟通

#### NaviBar动态路由支持
1. **动态路由标签**
   - 支持带参数的路由（如 `/order-management/detail/:orderNo`）
   - 动态生成标签名称（如"订单详情 - 102511084444301"）
   - 支持多个订单详情页同时打开

#### 文件变更
- **新增文件**
  - `src/pages/OrderManagement/OrderDetail.jsx` - 订单详情组件
  - `src/pages/OrderManagement/OrderDetail.css` - 订单详情样式

- **修改文件**
  - `src/layout/MainLayout.jsx` - 添加订单详情路由
  - `src/pages/OrderManagement/AllOrders.jsx` - 修改订单编号链接跳转逻辑
  - `src/layout/NaviBar.jsx` - 支持动态路由标签页

#### 样式优化
1. **卡片样式**
   - 渐变色标题背景
   - 蓝色底边框强调
   - 阴影效果
   - 圆角设计

2. **响应式设计**
   - 移动端适配
   - 小屏幕下标题栏垂直排列
   - 描述列表标签宽度自适应

### 系统管理页面标题显示

#### 界面调整
1. **诊所管理页面标题显示**
   - 在Card左侧添加"诊所管理"标题
   - 与地址管理页面保持一致的布局风格
   - 标题显示在表格顶部第一行

2. **工厂管理页面标题显示**
   - 在Card左侧添加"工厂管理"标题
   - 与地址管理页面保持一致的布局风格
   - 标题显示在表格顶部第一行

### 患者档案标题位置调整

#### 界面调整
1. **患者档案标题位置优化**
   - 将"患者档案"标题从页面顶部移至Card组件的title属性中
   - 与人员管理页面保持一致的布局风格
   - 标题显示在表格顶部第一行，而非页面顶部

2. **搜索栏位置优化**
   - 将搜索栏移至Card的extra区域（右侧）
   - 搜索栏与"患者档案"标题在同一行显示
   - 包含：患者姓名输入框、搜索按钮、添加患者档案按钮
   - 输入框宽度调整为200px以适应header布局

### 页面标题优化

#### 界面调整
1. **删除内容页面的重复标题**
   - 由于NaviBar已经显示页面标题，删除了各页面内容区域的重复标题
   - 优化了页面布局，减少视觉冗余
   - 影响的页面：
     - 首页
     - 一键下单
     - 产品库下单
     - 待下单
     - 全部订单
     - 待处理订单
     - 患者档案
     - 诊所管理
     - 工厂管理
     - 快递管理

### 导航栏（NaviBar）功能新增

#### 新增功能
1. **页面导航栏（NaviBar）**
   - 位置：Header下方、Sidebar右侧、内容页面上方
   - 功能：类似浏览器标签页，显示所有打开的页面
   - 样式：参考Microsoft 365设计风格

#### 功能特性
1. **标签页管理**
   - 自动记录访问过的页面
   - 支持点击标签页切换页面
   - 支持关闭标签页（首页不可关闭）
   - 关闭当前页面时自动导航到前一个标签页

2. **视觉设计**
   - 活动标签页：白色背景、蓝色底部边框、蓝色文字
   - 非活动标签页：透明背景、灰色文字
   - 悬停效果：浅灰色背景
   - 关闭按钮：带悬停动画效果

3. **布局调整**
   - 内容区域高度自动计算：`100vh - 64px(header) - 40px(navbar) - 32px(margins)`
   - NaviBar支持水平滚动（标签页过多时）

#### 文件变更
- **新增文件**
  - `src/layout/NaviBar.jsx` - 导航栏组件
  - `src/layout/NaviBar.css` - 导航栏样式

- **修改文件**
  - `src/layout/MainLayout.jsx` - 集成NaviBar组件
  - `src/layout/MainLayout.css` - 调整布局以适配NaviBar

## 2025-11-18

### 人员管理功能优化

#### 新增功能
1. **管理员权限标识**
   - 新增 `isAdmin` 字段，用于标识用户是否为管理员
   - 新建/编辑人员时，添加"管理员"复选框选项
   - 表格中新增"是否管理员"列，显示管理员状态
   - 管理员显示红色"管理员"标签,普通用户显示灰色"普通用户"标签

#### 界面调整
1. **表单字段名称优化**
   - 将"人员角色"改为"角色"，使界面更简洁
   - 表格列标题同步调整

2. **表格列顺序调整**
   - 序号
   - 医生
   - 手机号
   - 角色
   - **是否管理员**（新增）
   - 创建时间
   - 操作

#### 数据结构变更

**人员数据结构**
```javascript
{
  key: '1',
  name: '黄向荣',
  phone: '006598625613',
  createTime: '2019-02-19 10:30:00',
  role: '医生',
  isAdmin: true  // 新增字段
}
```

#### 功能说明

**新建人员**
- 填写姓名、手机号
- 选择角色（医生/助理/行政）
- **勾选"管理员"复选框**（可选）
- 设置密码

**编辑人员**
- 修改姓名、手机号
- 修改角色
- **修改管理员权限**

**显示效果**
- 管理员：红色"管理员"标签
- 普通用户：灰色"普通用户"标签

---

## 之前的更新

### 产品选择功能（2025-11-18）
- 创建可复用的产品库选择器组件
- 新增产品选择对话框
- 集成到一键下单页面
- 重构产品库下单页面

### 设计方案选择功能（2025-11-18）
- 创建设计方案选择对话框
- 上方Tab布局
- 单选机制
- 红点提示功能

### 附件选择功能（2025-11-18）
- 创建附件选择对话框
- 左右分栏布局
- 数量调整功能
- 智能选择机制
### 按钮与标签一致性调整

#### 优化内容
1. “我的”页面的对话框顶部“返回”统一为主按钮样式，与“确定”一致。
2. 工作台功能网格将“我的任务”重命名为“我的信息”。

#### 文件变更
- 修改文件
  - `../DentaSyncApp/src/pages/My.jsx` — 返回按钮样式改为主按钮
  - `../DentaSyncApp/src/pages/Workspace.jsx` — 功能项标签从“我的任务”改为“我的信息”

### 构建与预览修复

### 视觉与可用性修复

#### 修复内容
1. “我的”页面的三处对话框（个人信息、修改密码、联系我们）输入框文字颜色与背景一致导致不可见的问题修复。
   - 输入框文字颜色设为 `#333`，背景为白色，placeholder 颜色为 `#999`。

#### 文件变更
- 修改文件
  - `../DentaSyncApp/src/pages/My.css` — 输入框与页面正文文字颜色调整

#### 修复内容
1. Vite 构建失败（缺少入口 `index.html`）问题修复。
2. 新增 `DentaSyncApp/index.html` 作为 Vite 默认入口，加载 `src/main.jsx`。

#### 文件变更
- 新增文件
  - `../DentaSyncApp/index.html` — Vite 构建入口
